<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="../css/list.css">
		<link rel="stylesheet" type="text/css" href="../css/common.css">
		<link rel="stylesheet" type="text/css" href="../css/public.css">
		
	</head>
	<body>
		<!----------------------------头部-------------------------------------------->
		<div id="topbox"></div>
		
		<!-----------------------------商品导航--------------------------------------->
		<div id="indexbox">
			<div class="index">
				<a href="index.html">良仓</a>>
				<a href="index.html">商店</a>>
				<a href="">所有商品</a>>
				<a href="">女装</a>>
				连衣裙
			</div>
		</div>
		
		
			
		<!----------------------------商品列表--------------------------------------->
		<div id="contentbox">
			<!-----------------------商品展示------------------------------------->
			<div class="products"></div>
			
			<!---------------------------翻页------------------------------->
			<div class="pager">
				<div class="turn_page">
					<a href="" class="page_prev">上一页</a>
					<a href="">1</a>
					<a href="">2</a>
					<a href="">3</a>
					<a href="">4</a>
					<a href="">5</a>
					<a href="">6</a>
					<a href="" class="page_next">下一页</a>
					   |    跳转到
					<input class="goPage" value="1">  页
					<button>确认</button>
				</div>
			</div>
		</div>
		
		<!-------------------------------底部------------------------------>
		<div id="bottombox"></div>
		
			
		<!------------模板-------------------------->
		<script type="text/html" id="list">
			<%for(var i = 0;i < products.length;i++){ 
				var prod = products[i];
			%>
				<div class="item first">
				<div class="img">
					<a href="#"><img src="<%= prod.url %>" class="move"></a>
					<div class="cover"></div>
				</div>
				<a href="detail.html" class="intro">
					<p class="money">￥<span><%= prod.money %></span></p>
					<p class="tle"><%= prod.title %></p>
					<p class="id" style="display: none;"><%= prod.id %></p>
					<p class="desc"><%= prod.intro %></p>
					<a class="_cart" href="javascript:void(0)"><img class="goCart" src="../img/che2.png" ></a>
				</a>
				<div class="bar">
					<a href="javascript:void(0)" class="who"><img src="<%= prod.logo %>"><%= prod.brand %></a>
					<a href="javascript:void(0)" class="peach"></a>
				</div>
			</div>
			<% } %>
		</script>
		
		
		<script type="text/javascript" src="../js/jquery-1.12.4.min.js"></script>
		<script type="text/javascript" src="../js/jquery.cookie.js"></script>
		<script type="text/javascript" src="../js/template-native.js"></script>
		<script type="text/javascript" src="../js/jquery.fly.min.js"></script>
		
		<script type="text/javascript">
			$(function(){
				//引入头部
				$("#topbox").load("../html/include/header.html");
				//引入尾部
				$("#bottombox").load("../html/include/footer.html");
			});
			
			<!------------商品数据---------------------->
			$.getJSON("../json/list.json",function(responseData){
				var data = {
					products : responseData
				}
				var html = template("list",data);    
				$(".products").append(html)
			});
			
			//点击购物车图标时,保存cookie，加入购物车
			$(".products").delegate(".goCart","click",function(){
				console.log($(this));
				//获取页面的数据
				var product_id = $(this).parents("._cart").siblings(".intro").children(".id").text(),
					product_name = $(this).parents("._cart").siblings(".intro").children(".tle").text(),
					product_price = $(this).parents("._cart").siblings(".intro").children(".money").children("span").text(),
					product_amount = 1,
					product_pic = $(this).parents("._cart").siblings(".img").find(".move").attr("src");
				console.log(product_name,product_id,product_price,product_pic);
				
				var pro = {
					id : product_id,
					name : product_name,
					price : product_price,
					amount : 1,
					url : product_pic
				}
				console.log(pro)
				//保存到cookie
				$.cookie.json = true;
				var prod = $.cookie("products")||[];
				console.log(prod);
				var index = exist(product_id,prod);
				if(index === -1)
					prod.push(pro);
				else
					++prod[index].amount;
				$.cookie("products",prod,{expires:7});
				console.log($.cookie("products"));
				
				function exist(id,prod){
					for(var i = 0;i < prod.length;i++){
						if(prod[i].id === id)
							return i;
					}
					return -1;
				}
			});
			
			//购物车飞入效果
			$(function(){
				$(".products").on("click",".goCart",function(e){
					//购物车飞入效果
					var $fly = $("<img src='../img/che2.png' style='position:absolute;width:100px'>"),
						cartOffset = $("#fly").offset();
					$fly.fly({
						start : {
							top : e.pageY - $(window).scrollTop(),
							left : e.pageX
						},
						end : {
							top : cartOffset.top - $(window).scrollTop(),
							left : cartOffset.left,
							width : 0,
							height : 0
						}
					});
				});
			});
		</script>
		
	</body>
</html>
